<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event List - Whispering Vine Wine Co.</title>
    <link rel="icon" href="favicon.png" type="image/png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T57JWWVK');</script>
    <!-- End Google Tag Manager -->
    <style>
      :root {
        --background: 0 0% 100%;
        --foreground: 222.2 84% 4.9%;
        --card: 0 0% 100%;
        --card-foreground: 222.2 84% 4.9%;
        --popover: 0 0% 100%;
        --popover-foreground: 222.2 84% 4.9%;
        --primary: 222.2 47.4% 11.2%;
        --primary-foreground: 210 40% 98%;
        --secondary: 210 40% 96%;
        --secondary-foreground: 222.2 84% 4.9%;
        --muted: 210 40% 96%;
        --muted-foreground: 215.4 16.3% 46.9%;
        --accent: 210 40% 96%;
        --accent-foreground: 222.2 84% 4.9%;
        --destructive: 0 84.2% 60.2%;
        --destructive-foreground: 210 40% 98%;
        --border: 214.3 31.8% 91.4%;
        --input: 214.3 31.8% 91.4%;
        --ring: 222.2 84% 4.9%;
        --radius: 0.5rem;
      }

      * {
        box-sizing: border-box;
      }

      body {
        font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background-color: hsl(var(--background));
        color: hsl(var(--foreground));
        margin: 0;
        padding: 1.25rem;
        line-height: 1.5;
        -webkit-font-smoothing: antialiased;
        min-height: 100vh;
      }

      .container {
        max-width: 50rem;
        margin: 0 auto;
        padding: 2rem;
      }

      .logo {
        text-align: center;
        margin-bottom: 2rem;
      }

      .logo img {
        max-width: 12.5rem;
        height: auto;
        transition: transform 0.2s ease-in-out;
      }

      .logo img:hover {
        transform: scale(1.05);
      }

      h1 {
        color: hsl(var(--foreground));
        font-size: 2rem;
        font-weight: 600;
        margin-bottom: 2rem;
        text-align: center;
        line-height: 1.25;
      }

      ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      li {
        background: hsl(var(--card));
        border: 1px solid hsl(var(--border));
        margin: 1rem 0;
        border-radius: calc(var(--radius) + 2px);
        box-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        transition: all 0.2s ease-in-out;
        overflow: hidden;
      }

      li:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        border-color: hsl(var(--border));
      }

      .event-link {
        display: block;
        padding: 1.5rem;
        text-decoration: none;
        color: inherit;
        transition: background-color 0.15s ease-in-out;
      }

      .event-link:hover {
        background-color: hsl(var(--accent) / 0.5);
      }

      .event-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: hsl(var(--foreground));
        margin: 0 0 0.75rem 0;
        line-height: 1.25;
      }

      .event-details {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      .event-date, .event-time, .event-location {
        font-size: 0.875rem;
        color: hsl(var(--muted-foreground));
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .event-date i, .event-time i, .event-location i {
        width: 1rem;
        text-align: center;
        color: hsl(var(--muted-foreground));
      }

      .add-to-calendar {
        margin-top: 1rem;
      }

      .calendar-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        white-space: nowrap;
        border-radius: var(--radius);
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.15s ease-in-out;
        background-color: hsl(var(--primary));
        color: hsl(var(--primary-foreground));
        border: none;
        padding: 0.5rem 1rem;
        cursor: pointer;
        gap: 0.5rem;
      }

      .calendar-button:hover {
        background-color: hsl(var(--primary) / 0.9);
        transform: translateY(-1px);
      }

      .empty-state {
        text-align: center;
        padding: 3rem 1rem;
        color: hsl(var(--muted-foreground));
      }

      .empty-state i {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: hsl(var(--muted-foreground) / 0.5);
      }

      .empty-state h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: hsl(var(--foreground));
      }

      .loading {
        text-align: center;
        padding: 2rem;
        color: hsl(var(--muted-foreground));
      }

      .loading i {
        font-size: 2rem;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }

      /* Responsive Design */
      @media (max-width: 640px) {
        body {
          padding: 1rem;
        }

        .container {
          padding: 1.5rem;
        }

        h1 {
          font-size: 1.75rem;
        }

        .event-link {
          padding: 1.25rem;
        }

        .event-title {
          font-size: 1.125rem;
        }

        .event-details {
          gap: 0.375rem;
        }

        .logo img {
          max-width: 10rem;
        }
      }

      @media (max-width: 480px) {
        .container {
          padding: 1rem;
        }

        .event-link {
          padding: 1rem;
        }

        .event-details {
          font-size: 0.8125rem;
        }
      }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T57JWWVK"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    
    <div class="container">
        <div class="logo">
            <a href="https://wvwine.co">
                <img src="logo.png" alt="Whispering Vine Wine Co. Logo">
            </a>
        </div>
        <h1>Upcoming Events</h1>
        <div class="loading" id="loading">
            <i class="fas fa-spinner"></i>
            <p>Loading events...</p>
        </div>
        <ul id="event-list" style="display: none;"></ul>
        <div class="empty-state" id="empty-state" style="display: none;">
            <i class="fas fa-calendar-times"></i>
            <h3>No upcoming events</h3>
            <p>Check back soon for new events and experiences.</p>
        </div>
    </div>

    <script>
      // Function to format date in the required format
      const formatDate = (dateTime) => {
        const date = new Date(dateTime);
        const options = { weekday: 'long', month: 'short', day: 'numeric' };
        return date.toLocaleDateString('en-US', options);
      };

      // Function to format time in the required format
      const formatTime = (dateTime) => {
        const date = new Date(dateTime);
        return date.toLocaleTimeString([], { hour: 'numeric', minute: '2-digit' });
      };
        
      // Function to get the current date in YYYY-MM-DD format
      const getCurrentDate = () => {
        const now = new Date();
        return now.toISOString().split('T')[0];
      };
        
      // Function to display the list of events
      const displayEvents = async () => {
        const loadingElement = document.getElementById('loading');
        const eventListElement = document.getElementById('event-list');
        const emptyStateElement = document.getElementById('empty-state');

        try {
          const response = await fetch('https://cal.wvwine.co/events.json');
          if (!response.ok) throw new Error('Unable to fetch events');
          const events = await response.json();

          const now = new Date(); // Get the current date and time

          // Filter events to include only those that haven't ended yet
          const upcomingEvents = events.filter(event => new Date(event.endTime) > now);

          // Sort events by start time (nearest to farthest)
          upcomingEvents.sort((a, b) => new Date(a.startTime) - new Date(b.startTime));

          // Hide loading
          loadingElement.style.display = 'none';

          if (upcomingEvents.length === 0) {
            emptyStateElement.style.display = 'block';
            return;
          }

          eventListElement.style.display = 'block';
          eventListElement.innerHTML = ''; // Clear any existing content
          
          upcomingEvents.forEach(event => {
            const listItem = document.createElement('li');
            listItem.innerHTML = `
              <a href="https://cal.wvwine.co/${event.id}" class="event-link">
                <h2 class="event-title">${event.title}</h2>
                <div class="event-details">
                  <div class="event-date">
                    <i class="fas fa-calendar"></i>
                    ${formatDate(event.startTime)}
                  </div>
                  <div class="event-time">
                    <i class="fas fa-clock"></i>
                    ${formatTime(event.startTime)} - ${formatTime(event.endTime)}
                  </div>
                  <div class="event-location">
                    <i class="fas fa-map-marker-alt"></i>
                    ${event.location}
                  </div>
                </div>
                <div class="add-to-calendar">
                  <span class="calendar-button">
                    <i class="fas fa-calendar-plus"></i>
                    View Details
                  </span>
                </div>
              </a>
            `;
            eventListElement.appendChild(listItem);
          });
        } catch (error) {
          console.error('Error displaying events:', error);
          loadingElement.style.display = 'none';
          emptyStateElement.innerHTML = `
            <i class="fas fa-exclamation-triangle"></i>
            <h3>Unable to load events</h3>
            <p>Please try again later.</p>
          `;
          emptyStateElement.style.display = 'block';
        }
      };

      // Fetch and display events on page load
      document.addEventListener('DOMContentLoaded', displayEvents);
    </script>
</body>
</html>