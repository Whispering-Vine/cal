<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event List</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        color: #333;
        margin: 0;
        padding: 0;
      }
      .container {
        max-width: 800px;
        margin: auto;
        padding: 20px;
        background: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
      }
      h1 {
        color: #007BFF;
      }
      ul {
        list-style: none;
        padding: 0;
      }
      li {
        background: #f9f9f9;
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      }
      a {
        text-decoration: none;
        color: #007BFF;
      }
    </style>
</head>
<body>
    <div class="container">
        <h1>Upcoming Events</h1>
        <ul id="event-list"></ul>
    </div>

    <script>
      // Function to format date and time in the required format
      const formatDateTime = (dateTime) => {
        const [date, time] = dateTime.split('T');
        return `${date}T${time.split('.')[0]}Z`;
      };

      // Function to generate unique UID for the event
      const generateUID = () => {
        return [...Array(32)].map(() => Math.floor(Math.random() * 16).toString(16)).join('');
      };

      // Function to generate ICS file content
      const generateICSFile = (event) => {
        const { title, description, location, startTime, endTime } = event;
        const uid = generateUID();
        const formattedStartTime = formatDateTime(startTime);
        const formattedEndTime = formatDateTime(endTime);

        return `
BEGIN:VCALENDAR
VERSION:2.0
PRODID:Spatie calendar-links
BEGIN:VEVENT
UID:${uid}
DTSTAMP:${formattedStartTime}
DTSTART:${formattedStartTime}
DTEND:${formattedEndTime}
DESCRIPTION:${description}
LOCATION:${location}
SUMMARY:${title}
END:VEVENT
END:VCALENDAR
        `;
      };

      // Function to fetch event data from GitHub
      const fetchEventData = async (eventId) => {
        try {
          const response = await fetch(`https://raw.githubusercontent.com/Whispering-Vine/cal/main/events/${eventId}.json`);
          if (!response.ok) throw new Error('Event not found');
          return await response.json();
        } catch (error) {
          console.error('Error fetching event data:', error);
          return null;
        }
      };

      // Function to generate calendar URLs
      const generateCalendarUrls = (event) => {
        const { title, description, location, startTime, endTime } = event;

        const formattedTitle = encodeURIComponent(title);
        const formattedDescription = encodeURIComponent(description);
        const formattedLocation = encodeURIComponent(location);

        return {
          yahoo: `https://calendar.yahoo.com/?v=60&view=d&type=20&ST=${startTime}&ET=${endTime}&TITLE=${formattedTitle}&DESC=${formattedDescription}&in_loc=${formattedLocation}`,
          google: `https://calendar.google.com/calendar/u/0/r/eventedit?dates=${startTime}/${endTime}&ctz=America/Los_Angeles&text=${formattedTitle}&details=${formattedDescription}&location=${formattedLocation}`,
          outlook: `https://outlook.live.com/calendar/0/action/compose/?path=%2fcalendar%2faction%2fcompose&rru=addevent&startdt=${startTime}&enddt=${endTime}&subject=${formattedTitle}&body=${formattedDescription}&location=${formattedLocation}`,
          office365: `https://outlook.office.com/calendar/deeplink/compose?path=/calendar/action/compose&rru=addevent&startdt=${startTime}&enddt=${endTime}&subject=${formattedTitle}&body=${formattedDescription}&location=${formattedLocation}`
        };
      };

      // Function to display the list of events
      const displayEvents = async () => {
        try {
          const response = await fetch('https://raw.githubusercontent.com/Whispering-Vine/cal/main/events.json'); // Assuming this file contains all events
          if (!response.ok) throw new Error('Unable to fetch events');
          const events = await response.json();

          const eventList = document.getElementById('event-list');
          eventList.innerHTML = ''; // Clear any existing content

          events.forEach(event => {
            const listItem = document.createElement('li');
            listItem.innerHTML = `
              <h2>${event.title}</h2>
              <p>${event.startTime} - ${event.endTime}</p>
              <a href="/cal/${event.id}">View Details</a>
            `;
            eventList.appendChild(listItem);
          });
        } catch (error) {
          console.error('Error displaying events:', error);
        }
      };

      // Fetch and display events on page load
      document.addEventListener('DOMContentLoaded', displayEvents);
    </script>
</body>
</html>
