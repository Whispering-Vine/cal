<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100svh;
        }
        .container {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            max-width: 600px;
            width: 100%;
            position: relative;
        }
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #9c9c9c;
            color: #fff;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
        }
        .back-button i {
            margin-right: 8px;
        }
        h1 {
            font-size: 28px;
            margin-bottom: 20px;
        }
        .event-date {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .calendar-icon {
            background-color: #000;
            color: #fff;
            width: 60px;
            height: 60px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            margin-right: 15px;
            border-radius: 5px;
        }
        .calendar-icon .day {
            font-size: 24px;
        }
        .event-info {
            font-size: 18px;
        }
        .event-location, .event-details, .event-price {
            margin-top: 20px;
            font-style: italic;
            font-size: 16px;
        }
        .event-note {
            margin-top: 20px;
            white-space: pre-line;
        }
        .add-to-calendar {
            margin-top: 30px;
        }
        .add-to-calendar h2 {
            font-size: 20px;
            margin-bottom: 15px;
        }
        .calendar-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .calendar-button {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            text-decoration: none;
            color: #333;
            font-weight: bold;
            cursor: pointer;
        }
        .calendar-button i {
            margin-right: 5px;
        }
        .timezone {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #f0f0f0;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        .not-found {
            text-align: center;
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="back-button"><i class="fas fa-arrow-left"></i>Events</a>
        <div class="timezone">UTC -8 America/Los_Angeles</div>
        <div class="not-found" id="not-found" style="display: none;">
            <h1>404 - Event Not Found</h1>
            <p>The event you are looking for does not exist or has been moved.</p>
        </div>
        <div id="event-details">
            <h1 id="event-title">Trefethen Wine Tasting</h1>
            <div class="event-date">
                <div class="calendar-icon">
                    <div class="day" id="event-day">14</div>
                    <div id="event-month">AUG</div>
                </div>
                <div class="event-info">
                    <div id="event-day-name">Wednesday</div>
                    <div id="event-full-date">Aug 14, 2024</div>
                    <div id="event-time">4:00 PM - 7:00 PM</div>
                </div>
            </div>
            <div class="event-location" id="event-location">
                <i class="fas fa-map-marker-alt"></i> 85 Foothill Rd. Ste 1 Reno, NV 89511
            </div>
            <div class="event-note" id="event-description">
                 Buy any Trefethen bottle from the tasting and the tasting fee will be refunded.
             </div>
             <div class="add-to-calendar">
                  <h2>Add to Calendar</h2>
                  <div class="calendar-buttons">
                      <a href="#" class="calendar-button" id="google-link"><i class="fab fa-google"></i> Google</a>
                      <a href="#" class="calendar-button" id="apple-link" onclick="openAppleCalendar(event)"><i class="fab fa-apple"></i> Apple</a>
                      <a href="#" class="calendar-button" id="outlook-link"><i class="fas fa-envelope"></i> Outlook</a>
                      <a href="#" class="calendar-button" id="yahoo-link"><i class="fab fa-yahoo"></i> Yahoo</a>
                      <a href="#" class="calendar-button" id="office365-link"><i class="fab fa-microsoft"></i> Office365</a>
                      <a href="#" class="calendar-button" id="ics-link"><i class="fas fa-calendar-alt"></i> ICS File</a>
                 </div>
             </div>
         </div>
     </div>
     <script>
     // Function to fetch event data from GitHub
     const fetchEventData = async (eventId) => {
         try {
             const response = await fetch(`https://raw.githubusercontent.com/Whispering-Vine/cal/main/events/${eventId}.json`);
             if (!response.ok) throw new Error('Event not found');
             return await response.json();
         } catch (error) {
             console.error('Error fetching event data:', error);
             return null;
         }
     };
     
     // Function to generate calendar URLs
     const generateCalendarUrls = (event) => {
         const { title, description, location, startTime, endTime } = event;
         const formattedTitle = encodeURIComponent(title);
         const formattedDescription = encodeURIComponent(description);
         const formattedLocation = encodeURIComponent(location);
         return {
             yahoo: `https://calendar.yahoo.com/?v=60&view=d&type=20&ST=${startTime}&ET=${endTime}&TITLE=${formattedTitle}&DESC=${formattedDescription}&in_loc=${formattedLocation}`,
             google: `https://calendar.google.com/calendar/u/0/r/eventedit?dates=${startTime}/${endTime}&ctz=America/Los_Angeles&text=${formattedTitle}&details=${formattedDescription}&location=${formattedLocation}`,
             outlook: `https://outlook.live.com/calendar/0/action/compose/?path=%2fcalendar%2faction%2fcompose&rru=addevent&startdt=${startTime}&enddt=${endTime}&subject=${formattedTitle}&body=${formattedDescription}&location=${formattedLocation}`,
             office365: `https://outlook.office.com/calendar/deeplink/compose?path=/calendar/action/compose&rru=addevent&startdt=${startTime}&enddt=${endTime}&subject=${formattedTitle}&body=${formattedDescription}&location=${formattedLocation}`
         };
     };

     // Function to handle Apple Calendar link
     const openAppleCalendar = (event) => {
         event.preventDefault();
         const eventId = window.location.pathname.split('/').pop();
         if (!eventId) return;
         fetchEventData(eventId).then(event => {
             if (!event) return;
             const { title, startTime, endTime } = event;
             const formattedStartTime = new Date(startTime).toISOString().replace(/[-:]/g, '').slice(0, -1) + 'Z';
             const formattedEndTime = new Date(endTime).toISOString().replace(/[-:]/g, '').slice(0, -1) + 'Z';
             const appleCalendarUrl = `webcal://raw.githubusercontent.com/Whispering-Vine/cal/main/events/${eventId}.ics`;
             window.open(appleCalendarUrl, '_blank');
         });
     };

     // Function to handle 404 error
     const showNotFound = () => {
         document.getElementById('event-details').style.display = 'none';
         document.getElementById('not-found').style.display = 'block';
     };

     // Function to update the DOM with event details
     const updateEventDetails = async () => {
         const eventId = window.location.pathname.split('/').pop();
         if (!eventId) {
             showNotFound();
             return;
         }
         const event = await fetchEventData(eventId);
         if (!event) {
             showNotFound();
             return;
         }
         document.getElementById('event-title').textContent = event.title;
         document.getElementById('event-day').textContent = new Date(event.startTime).getDate();
         document.getElementById('event-month').textContent = new Intl.DateTimeFormat('en-US', { month: 'short' }).format(new Date(event.startTime)).toUpperCase();
         document.getElementById('event-day-name').textContent = new Intl.DateTimeFormat('en-US', { weekday: 'long' }).format(new Date(event.startTime));
         document.getElementById('event-full-date').textContent = new Intl.DateTimeFormat('en-US', { month: 'short', day: 'numeric', year: 'numeric' }).format(new Date(event.startTime));
         document.getElementById('event-time').textContent = `${new Intl.DateTimeFormat('en-US', { hour: 'numeric', minute: 'numeric', hour12: true }).format(new Date(event.startTime))} - ${new Intl.DateTimeFormat('en-US', { hour: 'numeric', minute: 'numeric', hour12: true }).format(new Date(event.endTime))}`;
         document.getElementById('event-location').textContent = "üìç" + event.location;
         document.getElementById('event-description').textContent = event.description;

         const calendarUrls = generateCalendarUrls(event);
         document.getElementById('google-link').href = calendarUrls.google;
         document.getElementById('apple-link').href = `webcal://raw.githubusercontent.com/Whispering-Vine/cal/main/events/${eventId}.ics`;
         document.getElementById('outlook-link').href = calendarUrls.outlook;
         document.getElementById('yahoo-link').href = calendarUrls.yahoo;
         document.getElementById('office365-link').href = calendarUrls.office365;
         document.getElementById('ics-link').href = `https://raw.githubusercontent.com/Whispering-Vine/cal/main/events/${eventId}.ics`;
     };

     document.addEventListener('DOMContentLoaded', updateEventDetails);
     </script>
</body>
</html>
