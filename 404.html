<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Not Found</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        color: #333;
        margin: 0;
        padding: 0;
      }
      .container {
        max-width: 800px;
        margin: auto;
        padding: 20px;
        background: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
      }
      h1 {
        color: #007BFF;
      }
      p {
        margin: 0 0 10px;
      }
      .calendar-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 20px;
      }
      .calendar-buttons a {
        display: flex;
        align-items: center;
        text-decoration: none;
        color: #fff;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 16px;
        font-weight: bold;
        width: 200px;
      }
      .calendar-buttons a i {
        margin-right: 8px;
      }
      .calendar-buttons .yahoo {
        background: #400090;
      }
      .calendar-buttons .google {
        background: #4285F4;
      }
      .calendar-buttons .outlook {
        background: #0078D4;
      }
      .calendar-buttons .office365 {
        background: #0078D4;
      }
      .calendar-buttons .apple {
        background: #A2AAAD;
      }
      .calendar-buttons .ics {
        background: #444;
      }
      .not-found {
        text-align: center;
        margin-top: 50px;
      }
    </style>
</head>
<body>
    <div class="container">
        <div class="not-found" id="not-found">
            <h1>404 - Event Not Found</h1>
            <p>The event you are looking for does not exist or has been moved.</p>
        </div>
        <div class="container" id="event-details" style="display: none;">
            <h1 id="event-title"></h1>
            <p id="event-description"></p>
            <p id="event-location"></p>
            <p id="event-datetime"></p>
            <div class="calendar-buttons">
                <a id="yahoo-link" class="yahoo" href="#" target="_blank"><i class="fab fa-yahoo"></i> Yahoo Calendar</a>
                <a id="google-link" class="google" href="#" target="_blank"><i class="fab fa-google"></i> Google Calendar</a>
                <a id="outlook-link" class="outlook" href="#" target="_blank"><i class="fab fa-microsoft"></i> Outlook.com Calendar</a>
                <a id="office365-link" class="office365" href="#" target="_blank"><i class="fab fa-microsoft"></i> Office365 Calendar</a>
                <a id="apple-link" class="apple" href="#" download><i class="fab fa-apple"></i> Apple Calendar</a>
                <a id="ics-link" class="ics" href="#" download><i class="fas fa-calendar-alt"></i> Download ICS File</a>
            </div>
        </div>
    </div>
    <script>
      // Function to fetch event data from GitHub
      const fetchEventData = async (eventId) => {
        try {
          const response = await fetch(`https://raw.githubusercontent.com/Whispering-Vine/cal/main/events/${eventId}.json`);
          if (!response.ok) throw new Error('Event not found');
          return await response.json();
        } catch (error) {
          console.error('Error fetching event data:', error);
          return null;
        }
      };

      // Function to generate calendar URLs
      const generateCalendarUrls = (event) => {
        const { title, description, location, startTime, endTime } = event;

        const formattedTitle = encodeURIComponent(title);
        const formattedDescription = encodeURIComponent(description);
        const formattedLocation = encodeURIComponent(location);

        return {
          yahoo: `https://calendar.yahoo.com/?v=60&view=d&type=20&ST=${startTime}&ET=${endTime}&TITLE=${formattedTitle}&DESC=${formattedDescription}&in_loc=${formattedLocation}`,
          google: `https://calendar.google.com/calendar/u/0/r/eventedit?dates=${startTime}/${endTime}&ctz=America/Los_Angeles&text=${formattedTitle}&details=${formattedDescription}&location=${formattedLocation}`,
          outlook: `https://outlook.live.com/calendar/0/action/compose/?path=%2fcalendar%2faction%2fcompose&rru=addevent&startdt=${startTime}&enddt=${endTime}&subject=${formattedTitle}&body=${formattedDescription}&location=${formattedLocation}`,
          office365: `https://outlook.office.com/calendar/deeplink/compose?path=/calendar/action/compose&rru=addevent&startdt=${startTime}&enddt=${endTime}&subject=${formattedTitle}&body=${formattedDescription}&location=${formattedLocation}`
        };
      };

      // Function to generate ICS file content
      const generateICSFile = (event) => {
        const { title, description, location, startTime, endTime } = event;
        return `
BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Your Company//NONSGML v1.0//EN
BEGIN:VEVENT
SUMMARY:${title}
DTSTART:${startTime}
DTEND:${endTime}
DESCRIPTION:${description}
LOCATION:${location}
END:VEVENT
END:VCALENDAR
        `;
      };

      // Function to handle showing the 404 page
      const showNotFound = () => {
        document.getElementById('not-found').style.display = 'block';
        document.getElementById('event-details').style.display = 'none';
      };

      (async () => {
        try {
          // Get event ID from URL
          const eventId = window.location.pathname.split('/').pop();
          if (!eventId) throw new Error('No event ID provided in the URL');

          // Fetch event data
          const event = await fetchEventData(eventId);
          if (!event) throw new Error('Event not found');

          // Generate URLs and ICS file
          const urls = generateCalendarUrls(event);
          const icsContent = generateICSFile(event);

          // Update the DOM with event details
          document.getElementById('event-title').textContent = event.title;
          document.getElementById('event-description').innerHTML = event.description;
          document.getElementById('event-location').textContent = event.location;
          document.getElementById('event-datetime').textContent = `${event.startTime} - ${event.endTime}`;

          document.getElementById('yahoo-link').href = urls.yahoo;
          document.getElementById('google-link').href = urls.google;
          document.getElementById('outlook-link').href = urls.outlook;
          document.getElementById('office365-link').href = urls.office365;

          // Create and download ICS file
          const blob = new Blob([icsContent], { type: 'text/calendar' });
          document.getElementById('ics-link').href = URL.createObjectURL(blob);
          document.getElementById('apple-link').href = URL.createObjectURL(blob);

          // Show event details and hide 404 message
          document.getElementById('event-details').style.display = 'block';
          document.getElementById('not-found').style.display = 'none';

        } catch (error) {
          console.error('Error fetching event data:', error);
          showNotFound();
        }
      })();
    </script>
</body>
</html>
